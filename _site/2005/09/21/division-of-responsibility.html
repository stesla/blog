<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Alieniloquent: Division of Responsibility</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-reset.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-fonts.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-grids.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/simple-style.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/blog.css"/>
  <link href="http://blog.alieniloquent.com/feed" rel="alternate" title="main feed" type="application/rss+xml"/>
</head>
<body>
 <div id="doc" class="yui-t4">
   <div id="hd" class="content">
     <h1 id="title"><a href="http://www.alieniloquent.com/">Alieniloquent</a></h1>
     <ul id="navigation">
       <li class="first"><a href="http://blog.alieniloquent.com">blog</a></li>
       <li><a href="http://github.com/stesla">code</a></li>
       <li><a href="http://www.alieniloquent.com/resume.pdf">resum&eacute;</a></li>
     </ul>
     <br/>
   </div>
   <div id="bd">
     <div id="yui-main">
       <div class="yui-b">
         <div class="post">
  <h3><a href="/2005/09/21/division-of-responsibility.html" title="Permalink for this post">Division of Responsibility</a></h3>
  <p class="date">September 21st, 2005</p>
  <div class="entry"><p>So I was looking at a C# class that looked something like this:</p>
<div class='highlight'><pre><code class='c'><span class='n'>class</span> <span class='n'>FooFactory</span>
<span class='p'>{</span>
  <span class='n'>private</span> <span class='n'>BazCollection</span> <span class='n'>_bazzen</span><span class='p'>;</span>
  <span class='n'>private</span> <span class='n'>QuxCollection</span> <span class='n'>_quxxen</span><span class='p'>;</span>

  <span class='c1'>// ...constructors, other methds, etc...</span>

  <span class='n'>public</span> <span class='n'>Foo</span> <span class='nf'>BuildFoo</span><span class='p'>(</span><span class='n'>Bar</span> <span class='n'>bar</span><span class='p'>)</span>
  <span class='p'>{</span>
    <span class='k'>return</span> <span class='n'>new</span> <span class='n'>Foo</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>,</span> <span class='n'>_bazzen</span><span class='p'>,</span> <span class='n'>_quxxen</span><span class='p'>.</span><span class='n'>FindQuxForBar</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>));</span>
  <span class='p'>}</span>

  <span class='c1'>// ...more stuff...</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>Now that smells to me. Take a moment and see if you can sniff it out. I&#8217;ll wait.</p>

<p>That&#8217;s right. We&#8217;re passing in <code>bar</code> and then also passing in something that we use <code>bar</code> to get. But that&#8217;s not all. I didn&#8217;t show it in the snippet, but inside Foo the way we use the BazCollection is <em>also</em> indexed by <code>bar</code>. So, we have this object and sometimes it indexes into a collection and sometimes the objects that construct it index into a collection for it. The responsibilities are muddled. Sometimes a Foo indexes in and sometimes it doesn&#8217;t.</p>

<p>The power that objects give us is to wrap up data and the responsibilities associated with that data into a nice little bundle. That power doesn&#8217;t do us a lot of good, though, if we don&#8217;t actually use it. In a case like this the responsibility of which object should be indexing into the collection is spread onto two objects, and only should be in one.</p>

<p>Now, one refactor that we could do would be to just pass the collection in for the Qux as well:</p>
<div class='highlight'><pre><code class='c'><span class='n'>public</span> <span class='n'>Foo</span> <span class='nf'>BuildFoo</span><span class='p'>(</span><span class='n'>Bar</span> <span class='n'>bar</span><span class='p'>)</span>
<span class='p'>{</span>
  <span class='k'>return</span> <span class='n'>new</span> <span class='n'>Foo</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>,</span> <span class='n'>_bazzen</span><span class='p'>,</span> <span class='n'>_quxxen</span><span class='p'>);</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>This refactor is not the one I would choose, though, as now it is even more complicated to construct a Foo. Specifically if I want to test my Foo (which I do, of course). The foo is only ever interested in a single Baz and a single Qux, so it&#8217;s just extra overhead to have to create a collection for each. That brings me to the next refactoring that I might try:</p>
<div class='highlight'><pre><code class='c'><span class='n'>public</span> <span class='n'>Foo</span> <span class='nf'>BuildFoo</span><span class='p'>(</span><span class='n'>Bar</span> <span class='n'>bar</span><span class='p'>)</span>
<span class='p'>{</span>
  <span class='k'>return</span> <span class='n'>new</span> <span class='n'>Foo</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>,</span> <span class='n'>_bazzen</span><span class='p'>.</span><span class='n'>FindBazForBar</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>),</span> <span class='n'>_quxxen</span><span class='p'>.</span><span class='n'>FindQuxForBar</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>));</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>This has the advantage of making Foo&#8217;s responsibility very clear. It is meant to bring the bar, baz, and qux together. But, that call-site still stinks. In fact, it reeks more with that original odor. At this point, it would be worthwhile to see what Foo actually needs the Bar for and further factor that out. Maybe we can have something like this:</p>
<div class='highlight'><pre><code class='c'><span class='n'>public</span> <span class='n'>Foo</span> <span class='nf'>BuildFoo</span><span class='p'>(</span><span class='n'>Bar</span> <span class='n'>bar</span><span class='p'>)</span>
<span class='p'>{</span>
  <span class='k'>return</span> <span class='n'>new</span> <span class='n'>Foo</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>.</span><span class='n'>name</span><span class='p'>,</span> <span class='n'>bar</span><span class='p'>.</span><span class='n'>id</span><span class='p'>,</span> <span class='n'>_bazzen</span><span class='p'>.</span><span class='n'>FindBazForBar</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>),</span> <span class='n'>_quxxen</span><span class='p'>.</span><span class='n'>FindQuxForBar</span><span class='p'>(</span><span class='n'>bar</span><span class='p'>));</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>That way we remove the dependence on Bar completely from the Foo, and push it into the FooFactory. Maybe we will create an object that encapsulates those parameters. In fact, maybe this factory is that object. But one thing is for sure, this code is better separated and easier to test and use than the original.</p></div>
  <p class="metadata alt">You may notice that I do not provide a space
    for comments. If you want to start a conversation, you can
    <a href="mailto:blog@alieniloquent.com">email me</a>, 
    <a href="http://twitter.com/stesla">tweet at me</a>, or post
    something on your own blog.</p>
</div>

       </div>
     </div>
     <div class="yui-b">
       <div class="yui-u sidebar">
         <h2 class="sectionheader first">Archives</h2>
         <ul>
           
           <li><a href="/2011/">2011</a></li>
           
           <li><a href="/2010/">2010</a></li>
           
           <li><a href="/2009/">2009</a></li>
           
           <li><a href="/2008/">2008</a></li>
           
           <li><a href="/2007/">2007</a></li>
           
           <li><a href="/2006/">2006</a></li>
           
           <li><a href="/2005/">2005</a></li>
           
         </ul>
       </div>
     </div>
   </div>
   <div id="ft">
     <p>Layout, design, graphics, photography and text all &copy; 2005-2010 Samuel Tesla unless otherwise noted.</p>
     <p>Portions of the site layout use Yahoo! YUI Reset, Fonts &amp; Grids.</p>
   </div>
 </div>

<!-- BEGIN GOOGLE ANALYTICS -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-12538528-2");
pageTracker._setDomainName(".alieniloquent.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- END GOOGLE ANALYTICS -->

</body>
</html>

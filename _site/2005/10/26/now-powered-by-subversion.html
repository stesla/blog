<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Alieniloquent: Now powered by Subversion</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-reset.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-fonts.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-grids.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/simple-style.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/blog.css" />
</head>
<body>
 <div id="doc" class="yui-t4">
   <div id="hd" class="content">
     <h1 id="title"><a href="http://www.alieniloquent.com/">Alieniloquent</a></h1>
     <ul id="navigation">
       <li class="first"><a href="http://blog.alieniloquent.com">blog</a></li>
       <li><a href="http://github.com/stesla">code</a></li>
       <li><a href="http://www.alieniloquent.com/resume.pdf">resum&eacute;</a></li>
     </ul>
     <br/>
   </div>
   <div id="bd">
     <div id="yui-main">
       <div class="yui-b">
         <div class="post">
  <h3><a href="/2005/10/26/now-powered-by-subversion.html" title="Permalink for this post">Now powered by Subversion</a></h3>
  <p class="date">October 26th, 2005</p>
  <div class="entry"><p>I <a href='http://www.alieniloquent.com/2005/10/20/subversive-joy/'>previously</a> <a href='http://www.alieniloquent.com/2005/10/20/subversion-apache-windows/'>blogged</a> about Subversion at my workplace. I promised that I would write a blog post about how the conversion went. Many of you may think that I forgot. I didn&#8217;t. We just finished it today, and as I expected, I have things to share.</p>

<p>Saturday evening I kicked off <a href='http://vss2svn.tigris.org/'>vss2svn</a> after installing all the things I needed to run it. I had done this before on a small repository, but it was long enough ago that I didn&#8217;t remember exactly what it was like. So I started it, and disconnected from VNC figuring it would take it a while. It did, indeed, take it a while. In fact, it still hadn&#8217;t done a <em>single thing</em> when I came in Monday morning. VSS has this need for a username to be specified. It will use your windows login if it&#8217;s a valid VSS user, but if it isn&#8217;t, the command line tool will prompt for one. The script ate that prompt, so I didn&#8217;t see it. That brings me to the first lesson.</p>

<p><strong>Lesson #1: Login to windows as a user with a VSS account.</strong></p>

<p>Monday, having guessed that was the problem, I fixed that by creating a VSS account for the user I was running as. Problem solved. The script ran and it built its database, and it told us what users we needed to have. I put all of those users in my password file and hit enter. Boom! It blew up. It gave some sort of error about not being able to import. After a good deal of time, it was discerned that the script was not properly forming the import command. It&#8217;s a good thing I know Perl.</p>

<p><strong>Lesson #2: Download the perl script, not the executable, you <em>will</em> need to hack the source.</strong></p>

<p>Having fixed the script I launched the process. It ran again. This is the point at which I start getting really annoyed at the fact that the script doesn&#8217;t pick things up where it left off. We are dealing with a very large codebase here, so it takes a while to analyze. Thank goodness I was running this on the machine where VSS and SVN are served and not over the network.</p>

<p>So it starts going. It converts. It converts some more. We get through two hours and about 1500 revisions when, yes you guessed it, BOOM! It blows up. This time it is asking for a revision of a file that VSS doesn&#8217;t have. This is somewhat odd, because you&#8217;d think that&#8217;s what version control is for: to keep old revisions. Well, you see, Microsoft decided to add a feature to VSS that would allow you to keep all the revision history but only store the most recent version of the file. So, if you analyze the history to figure out commits and then ask for an old revision&#8230;you get nothing. Try to add a file that doesn&#8217;t exist to Subversion, and you get an error.</p>

<p><strong>Lesson #3: VSS has a lot of retarded [mis]features.</strong></p>

<p>Ruby to the rescue! We write a script to figure out how many of these files exist. We run it. Wow, that&#8217;s a lot of files. We look at all of them, and determine that we don&#8217;t care about their revision history anyway. So we&#8217;ll just &#8220;delete&#8221; them all from VSS and then re-add them. We&#8217;ve got a command line tool. It can perform both operations. Excellent! We&#8217;ll just write another Ruby script. If only things were so simple.</p>

<p>Given that it&#8217;s Microsoft &#8211; the same company that said nobody would need more than 640k of memory &#8211; I don&#8217;t find it surprising that our script didn&#8217;t work. I think somebody said &#8220;nobody will ever want to script VSS.&#8221; You see, when you &#8220;delete&#8221; a file from VSS, you don&#8217;t actually delete the file. You simply set the file aside in a pile of files that you don&#8217;t play with any more, but it&#8217;s still there, even though you don&#8217;t play anymore. If you try to add a file with the same name in the VSS GUI, it will say &#8220;You used to play with this file, would you like to just play with the file you used to have, or would you rather play with this new file instead?&#8221; If you try the same thing using <code>ss.exe</code> (the CLI), it simply says &#8220;You already have a file with that name, sucker.&#8221; Stupid program.</p>

<p><strong>Lesson #4: ss.exe sucks</strong></p>

<p>Once I readded all of those files by hand, and later discovered that ss.exe put them somewhere else that was nowhere near where we asked it to, I kicked off the script again. It ran, and ran, and ran, and ran. Then it ran and ran and ran and ran. We started it Monday afternoon and it finished Wednesday morning. It did, however, convert successfully.</p>

<p><strong>Lesson #5: 1,000,000ish lines of code and 8ish years of history = 2 days to convert</strong></p>

<p>So, today we fixed up our buildscript (which was easyish) and our cruise control, and we got everybody switched over. Our shop is now powered by Subversion.</p></div>
  <p class="metadata alt">You may notice that I do not provide a space
    for comments. If you want to start a conversation, you can
    <a href="mailto:blog@alieniloquent.com">email me</a>, 
    <a href="http://twitter.com/stesla">tweet at me</a>, or post
    something on your own blog.</p>
</div>

       </div>
     </div>
     <div class="yui-b">
       <div class="yui-u sidebar">
         <h2 class="sectionheader first">Archives</h2>
         <ul>
           
           <li><a href="/2011/">2011</a></li>
           
           <li><a href="/2010/">2010</a></li>
           
           <li><a href="/2009/">2009</a></li>
           
           <li><a href="/2008/">2008</a></li>
           
           <li><a href="/2007/">2007</a></li>
           
           <li><a href="/2006/">2006</a></li>
           
           <li><a href="/2005/">2005</a></li>
           
         </ul>
       </div>
     </div>
   </div>
   <div id="ft">
     <p>Layout, design, graphics, photography and text all &copy; 2005-2010 Samuel Tesla unless otherwise noted.</p>
     <p>Portions of the site layout use Yahoo! YUI Reset, Fonts &amp; Grids.</p>
   </div>
 </div>

<!-- BEGIN GOOGLE ANALYTICS -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-12538528-2");
pageTracker._setDomainName(".alieniloquent.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- END GOOGLE ANALYTICS -->

</body>
</html>

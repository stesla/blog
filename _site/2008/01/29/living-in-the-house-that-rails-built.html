<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Alieniloquent: Living In the House That Rails Built</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-reset.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-fonts.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-grids.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/simple-style.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/blog.css"/>
  <link href="http://blog.alieniloquent.com/feed" rel="alternate" title="main feed" type="application/rss+xml"/>
</head>
<body>
 <div id="doc" class="yui-t4">
   <div id="hd" class="content">
     <h1 id="title"><a href="http://www.alieniloquent.com/">Alieniloquent</a></h1>
     <ul id="navigation">
       <li class="first"><a href="http://blog.alieniloquent.com">blog</a></li>
       <li><a href="http://github.com/stesla">code</a></li>
       <li><a href="http://www.alieniloquent.com/resume.pdf">resum&eacute;</a></li>
     </ul>
     <br/>
   </div>
   <div id="bd">
     <div id="yui-main">
       <div class="yui-b">
         <div class="post">
  <h3><a href="/2008/01/29/living-in-the-house-that-rails-built.html" title="Permalink for this post">Living In the House That Rails Built</a></h3>
  <p class="date">January 29th, 2008</p>
  <div class="entry"><p>I wanted to share a snippet of code. This code will print a call stack to <code>STDOUT</code> every time a Ruby class definition is evaluated. It is particularly useful when you find that class constants are being mysteriously redefined.</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Foo</span>
  <span class='nb'>puts</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>Required from:</span><span class='se'>\n</span><span class='s2'> </span><span class='si'>#{</span><span class='no'>Kernel</span><span class='o'>.</span><span class='n'>caller</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'> &quot;</span><span class='p'>)</span><span class='si'>}</span><span class='s2'>&quot;</span>
  <span class='c1'># ...</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>What inspired me to write that code? Rails did. The key to writing Ruby on Rails is that you&#8217;re writing Ruby <em>on Rails</em>. You don&#8217;t follow the Rails best practices because they&#8217;re convenient. You follow the Rails best practices because your program won&#8217;t work unless you do. Just like trains, you stay on the track and everything is great. If you try to take your train off-track, then it&#8217;s gruesome enough to make the nightly news.</p>

<p>How did I derail my application such that I cared how and where a file was being required? I wrote a unit test that explicitly required a model object. Oops. Remember that the semantics of <code>require</code> is load-once based on the name. So:</p>
<div class='highlight'><pre><code class='ruby'><span class='nb'>require</span> <span class='s2'>&quot;foo&quot;</span>
</code></pre>
</div>
<p>and:</p>
<div class='highlight'><pre><code class='ruby'><span class='nb'>require</span> <span class='s2'>&quot;models/foo&quot;</span>
</code></pre>
</div>
<p>are very different to require. Rails is super helpful and requires everything that it makes for you. So it requires models for you, even when you run your unit tests.</p>

<p>So take this code:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Foo</span> <span class='o'>&lt;</span> <span class='no'>ActiveRecord</span><span class='o'>::</span><span class='no'>Base</span>
  <span class='no'>RAILS_IS_A_GHETTO</span> <span class='o'>=</span> <span class='kp'>true</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>And then write a test for something that Rails didn&#8217;t generate (such as something in the <code>lib</code> directory like I did):</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># Require some other stuff</span>
<span class='nb'>require</span> <span class='s2'>&quot;foo&quot;</span>

<span class='k'>class</span> <span class='nc'>TestTruth</span> <span class='o'>&lt;</span> <span class='no'>Test</span><span class='o'>::</span><span class='no'>Unit</span><span class='o'>::</span><span class='no'>TestCase</span>
  <span class='k'>def</span> <span class='nf'>test_truth</span>
    <span class='n'>assert</span> <span class='kp'>true</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>If you <code>rake test</code> you will get an error complaining that <code>RAILS_IS_A_GHETTO</code> was reinitialized, and that&#8217;s because Rails loads it for you as &#8220;models/foo&#8221; and you load it as &#8220;foo&#8221; so it gets loaded twice.</p>

<p>The moral of the story is: let Rails load the things it built, and you load the things you built.</p></div>
  <p class="metadata alt">You may notice that I do not provide a space
    for comments. If you want to start a conversation, you can
    <a href="mailto:blog@alieniloquent.com">email me</a>, 
    <a href="http://twitter.com/stesla">tweet at me</a>, or post
    something on your own blog.</p>
</div>

       </div>
     </div>
     <div class="yui-b">
       <div class="yui-u sidebar">
         <h2 class="sectionheader first">Archives</h2>
         <ul>
           
           <li><a href="/2011/">2011</a></li>
           
           <li><a href="/2010/">2010</a></li>
           
           <li><a href="/2009/">2009</a></li>
           
           <li><a href="/2008/">2008</a></li>
           
           <li><a href="/2007/">2007</a></li>
           
           <li><a href="/2006/">2006</a></li>
           
           <li><a href="/2005/">2005</a></li>
           
         </ul>
       </div>
     </div>
   </div>
   <div id="ft">
     <p>Layout, design, graphics, photography and text all &copy; 2005-2010 Samuel Tesla unless otherwise noted.</p>
     <p>Portions of the site layout use Yahoo! YUI Reset, Fonts &amp; Grids.</p>
   </div>
 </div>

<!-- BEGIN GOOGLE ANALYTICS -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-12538528-2");
pageTracker._setDomainName(".alieniloquent.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- END GOOGLE ANALYTICS -->

</body>
</html>

<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Alieniloquent: 2008</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-reset.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-fonts.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/yui-grids.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/simple-style.css"/>
  <link rel="stylesheet" type="text/css" href="/stylesheets/blog.css" />
</head>
<body>
 <div id="doc" class="yui-t4">
   <div id="hd" class="content">
     <h1 id="title"><a href="http://www.alieniloquent.com/">Alieniloquent</a></h1>
     <ul id="navigation">
       <li class="first"><a href="http://blog.alieniloquent.com">blog</a></li>
       <li><a href="http://github.com/stesla">code</a></li>
       <li><a href="http://www.alieniloquent.com/resume.pdf">resum&eacute;</a></li>
     </ul>
     <br/>
   </div>
   <div id="bd">
     <div id="yui-main">
       <div class="yui-b">
         
<div class="post">
  <h3><a href="/2008/11/19/still-not-dead.html" rel="bookmark" title="Permanent Link to Still Not Dead">Still Not Dead</a></h3>
  <p class="date">November 19th, 2008</p>
  <div class="entry"><p>So, the October ODYNUG meeting came and went, and it was great. My talk went well, despite my not having written my blogging tool.</p>

<p>It is amazing how busy a person can get with what seems like only a few things on his plate. Between my classes and work, I&#8217;ve been staying busy. I tried to do <a href='http://www.nanowrimo.org/'>NaNoWriMo</a>, but failed. I couldn&#8217;t even get a thousand words written because I am so busy.</p>

<p>I realized I hadn&#8217;t updated since September, and wanted to poke my head in and let you all know that in a month, I won&#8217;t be so busy. Come the middle of December, I&#8217;ll start working on blogerl again. I&#8217;ve made some design re- decisions. I&#8217;m basically going to be doing something similar to <a href='http://blosxom.sourceforge.net/'>blosxom</a>. It meshes well with my design goals, and I can even keep my posts in git if I want.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/09/22/not-dead-yet.html" rel="bookmark" title="Permanent Link to Not Dead Yet">Not Dead Yet</a></h3>
  <p class="date">September 22nd, 2008</p>
  <div class="entry"><p>I just wanted to poke my head in and say that I&#8217;m still around, and still working on/thinking about the erlang project. I am, after all, still giving the talk next month.</p>

<p>I am, however, getting super busy with school. So, I&#8217;m having to sit down and schedule all of my non-work programming time. It&#8217;s looking like the erlang project isn&#8217;t going to get much love until after the end of September.</p>

<p>That said, when I get a few free moments this week, I&#8217;ll post some code I&#8217;ve already written that makes a nice interface around shelling out from erlang.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/09/11/erlang-project-storage-choice.html" rel="bookmark" title="Permanent Link to Erlang Project: Storage Choice">Erlang Project: Storage Choice</a></h3>
  <p class="date">September 11th, 2008</p>
  <div class="entry"><p>It was <a href='http://blog.alieniloquent.com/2008/09/08/erlang-project-stories/#comment-45637'>suggested</a> that I use <a href='http://couchdb.org/'>CouchDB</a> as the storage engine for blogerl. I&#8217;m not going to be using CouchDB for this project, and I would like to explain why.</p>

<p>My reason for choosing Git over CouchDB is really just a preference. I think Git is neat, and I want to use it in a novel way. I&#8217;d like to demonstrate how it is a very powerful tool and can be used to do more that just version software. I think CouchDB is cool, and at some point, I&#8217;ll probably do a project with it. But, for this project, it&#8217;s not what I want.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/09/08/erlang-project-stories.html" rel="bookmark" title="Permanent Link to Erlang Project: Stories">Erlang Project: Stories</a></h3>
  <p class="date">September 8th, 2008</p>
  <div class="entry"><p>In my previous <a href='http://blog.alieniloquent.com/2008/09/06/erlang-project-goals/'>post</a>, I discussed the goals and priorities for blogerl. This time I am going to brainstorm some stories and prioritize them. Then I&#8217;ll select the first few from the prioritized list to be my first iteration. The goal is to have something I can deploy so I can get the blog started as soon as possible.</p>

<p>My philosophy for stories is to give them titles that are short. The story names are simply mnemonics to assist with recalling conversations and other details. Since I&#8217;m a team of one, the only conversations will be those I have here with you. But after this post, I&#8217;ll probably just refer to the stories by their title.</p>

<p>Here are the stories in priority order:</p>

<dl>
<dt>Storage</dt>

<dd>I need some way to store my posts. I&#8217;m not very choosy about how this is done. But, because I am in an experimental mood, I&#8217;m going to opt for using <a href='http://git.or.cz/'>Git</a>. I&#8217;m probably going to end up using <a href='http://github.com/mojombo/grit/tree/master'>Grit</a> via <a href='http://code.google.com/p/erlectricity/'>erlectricity</a>. There&#8217;s already been a <a href='http://atonie.org/2008/02/git-wiki'>wiki</a> built on top of Git, why not a blog?</dd>

<dt>RESTful interface</dt>

<dd>Like I said before, I don&#8217;t want to compose my posts in a <code>&lt;textarea&gt;</code> but I do need to be able to get content into my application somehow. So, I&#8217;m going to design a RESTful interface to my data store. This is going to have to include an authentication mechanism, since I don&#8217;t want just anybody to be able to update or edit my blog.</dd>

<dt>Emacs mode</dt>

<dd>My preferred program for editing anything is Emacs. So it seems only natural that I&#8217;d choose to write my first REST client as an emacs mode.</dd>

<dt>Index</dt>

<dd>A front page that shows the posts in reverse chronological order. Should be paginated with 10 posts to a page.</dd>

<dt>Single</dt>

<dd>Permalinked pages for each individual post.</dd>

<dt>RSS</dt>

<dd>Add an RSS feed for the main index.</dd>

<dt>Atom</dt>

<dd>Add an Atom feed for the main index.</dd>

<dt>Archives</dt>

<dd>Provide archives based on year and month.</dd>

<dt>Templates</dt>

<dd>Templates for each of the views. Not YAWS pages. This will involve creating my own template language. I don&#8217;t like <a href='http://yarivsblog.com/articles/2006/10/17/introducting-erltl-a-simple-'>ErlTL</a> for this as it is too programmery.</dd>

<dt>Caching</dt>

<dd>Keep rendered content in a cache with a TTL. Expire the cache for the index page if a post is added, edited or deleted. Expire the cache for a single post if it is edited or deleted.</dd>

<dt>Tags</dt>

<dd>Be able to specify an arbitrary number of tags to associate with a post. Provide archive pages for each tag.</dd>

<dt>Comments</dt>

<dd>Provide comments. They do not need to be threaded. Plain, flat comments are sufficient.</dd>

<dt>Trackbacks</dt>

<dd>Provide the ability for other blogs to post trackbacks.</dd>

<dt>Post-dating</dt>

<dd>Give the ability to submit a post that will be published at a later date.</dd>

<dt>Markdown</dt>

<dd>Add support for formatting a post in the Markdown formatting language.</dd>

<dt>Textile</dt>

<dd>Add support for formatting a post in the textile formatting language.</dd>

<dt>Formatting default</dt>

<dd>Add a configuration option specifying the default formatting (which starts out as plain HTML).</dd>
</dl>

<p>The first six are going to be what I aim to complete before I tag an 0.1 and deploy to my webserver. That&#8217;ll give me a means to share my blog posts with people as a stream or individually via their browsers or via RSS feeds.</p>

<p>erlang-template-language/</p></div>
</div>

<div class="post">
  <h3><a href="/2008/09/06/erlang-project-goals.html" rel="bookmark" title="Permanent Link to Erlang Project: Goals">Erlang Project: Goals</a></h3>
  <p class="date">September 6th, 2008</p>
  <div class="entry"><p>First off, I&#8217;ve decided on a name for my project: blogerl. I will be hosting the source code <a href='http://github.com/stesla/blogerl/tree/master'>here</a> on GitHub.</p>

<p>With that bookkeeping out of the way, I&#8217;ll get to the meat of the post. I want to include you in my brainstorming process as I figure out what my goals are with this project. In my next post I&#8217;ll brainstorm features that will help me meet these goals and select a subset of those features to implement initially.</p>

<p>Before I can start brainstorming features, I need to figure out an overall vision for <em>what</em> I am trying to build. So the first thing I want to describe is the primary goal of this system, and possibly some secondary goals as well.</p>

<blockquote>
<p>I want a system that will manage the storage and presentation of my blog content. That content will be primarily textual, and may be annotated with various pieces of meta-data (e.g. date, title, or tags).</p>
</blockquote>

<p>That&#8217;s pretty vague, and I can design several extremely different systems that will deliver on that, so I&#8217;m going to provide some additional goals, in priority order, to narrow the design down.</p>

<dl>
<dt>Adding or editing content should be easy.</dt>

<dd>So many blogging tools are a pain to use. I&#8217;ll be honest, I&#8217;m not the biggest fan of the web application. Especially not for things like writing. I intend for Omniloquent to frequently have essays, and I don&#8217;t really like doing massive amounts of writing in a <code>&lt;textarea&gt;</code>.</dd>

<dt>Viewing the website should be fast.</dt>

<dd>This isn&#8217;t usually a problem in most modern blogging tools. However, I&#8217;m writing this one from scratch, so it&#8217;s going to be a little less modern at first. I don&#8217;t want people to be sitting around waiting for my content to load. I want it to be snappy. The closer to static content it feels, the happier I&#8217;ll be.</dd>

<dt>Adding or editing content should be fast.</dt>

<dd>The converse of the previous goal: I don&#8217;t want posting to take forever. This is why I hate Movable Type. The idea that I should have to rebuild dozens of pages when I just update a single post is ridiculous. However, I am willing to suffer a little, as I recognize that I&#8217;d rather it take me a second or two to post but have the blog be lightning fast for my readers. That said, the closer to instantaneous posting I can get, the happier I&#8217;ll be.</dd>
</dl></div>
</div>

<div class="post">
  <h3><a href="/2008/09/05/prodigal-blogger-returns.html" rel="bookmark" title="Permanent Link to Prodigal Blogger Returns">Prodigal Blogger Returns</a></h3>
  <p class="date">September 5th, 2008</p>
  <div class="entry"><p>Hi. I know it&#8217;s been a long time. Things have been crazy-busy for me all summer, and as usual, the blog fell by the wayside.</p>

<p>One of the things keeping me busy has been my new job. Yes, I got <em>another</em> new job. Since June, I&#8217;ve been working at <a href='http://www.engineyard.com'>Engine Yard</a> as a developer on the Vertebra project, and recently I&#8217;ve taken over as development lead. It&#8217;s very exciting and fulfilling to be working on such an interesting problem.</p>

<p>I&#8217;ve also been speaking and traveling quite a bit. I spoke at both <a href='http://barcamp.org/BarCampKC'>BarCampKC</a> and <a href='http://www.barcampomaha.org'>BarCampOmaha</a>, and my usual user group talks.</p>

<p>But, the real reason I haven&#8217;t written since March, is that I just haven&#8217;t had ideas about which I wanted to write. I finally decided that I needed to start writing even if I couldn&#8217;t think of anything to write about. Of course, at that moment, an idea occurred to me.</p>

<p>I&#8217;m going to be starting a series of posts over the next month. I&#8217;m working on a project for my Advanced Erlang talk next month at <a href='http://odynug.kicks-ass.org'>ODYNUG</a>, and I&#8217;m going to blog about it.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/09/05/erlang-project-kickoff.html" rel="bookmark" title="Permanent Link to Erlang Project: Kickoff">Erlang Project: Kickoff</a></h3>
  <p class="date">September 5th, 2008</p>
  <div class="entry"><p>On October 14th, I will be giving a talk at <a href='http://odynug.kicks-ass.org'>ODYNUG</a> about advanced <a href='http://www.erlang.org'>erlang</a>. Unlike my previous talks, this one is going to delve into the code of a real application. I&#8217;ll be discussing the architecture of the application and the reasons behind the design decisions.</p>

<p>Of course, in order to do that, I need an application. More specifically, I need an application for which I know all the reasons behind the design decisions. So, I&#8217;m going to write one, and I&#8217;m not a person to buck a tradition, so I&#8217;m going to write a blog.</p>

<p>I&#8217;ll be documenting the process here, and you can see the blog live <a href='http://omniloquent.com'>here</a>.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/03/31/dont-mandate-velocity.html" rel="bookmark" title="Permanent Link to Don't Mandate Velocity">Don't Mandate Velocity</a></h3>
  <p class="date">March 31st, 2008</p>
  <div class="entry"><p>I came across this amusing (fictional) story about a <a href='http://blog.objectmentor.com/articles/2008/03/05/turn-back-the-dial'>broken watch</a>, and it&#8217;s impact on the author&#8217;s development process.</p>

<p>I particularly liked one of the author&#8217;s comments in the comment thread:</p>

<blockquote>
<p>Velocity is a measurement that comes out of development, not an input that goes into it.</p>

<p>[Uncle Bob] said &#8230; that when you are trying to measure something, it&#8217;s counter-productive to put pressure on it.</p>
</blockquote></div>
</div>

<div class="post">
  <h3><a href="/2008/03/08/git-svn-with-svnexternals.html" rel="bookmark" title="Permanent Link to <code>git-svn</code> with <code>svn:externals</code>"><code>git-svn</code> with <code>svn:externals</code></a></h3>
  <p class="date">March 8th, 2008</p>
  <div class="entry"><p>I&#8217;ve really fallen <a href='http://blog.alieniloquent.com/2008/02/20/svn-git-awesome/'>head</a> over <a href='http://blog.alieniloquent.com/2008/02/22/svn-git-1-still-awesome/'>heels</a> in love with Git. But my original solution was really a hack. There is a better way to do it. In fact, it&#8217;s so much better, it comes with Git.</p>

<p>I took a look at <a href='http://www.kernel.org/pub/software/scm/git/docs/git-svn.html'><code>git-svn</code></a> when I was researching this a couple weeks ago, and the trouble that I had was that it didn&#8217;t fetch externals. Rather than figure out the problem, I just moved on with the working solution that I had. But, it bothered me. So I continued to research, and sure enough, Git has a way to do it just fine.</p>

<p>Nazar Aziz over at <a href='http://panthersoftware.com'>Panther Software</a> posted an excellent <a href='http://panthersoftware.com/articles/view/3/svn-s-svn-externals-to-git-s-submodule-for-rails-plugins'>guide</a> for setting up a Rails app with plugins using <code>git-svn</code> and <a href='http://www.kernel.org/pub/software/scm/git/docs/user-manual.html#submodules'>Git submodules</a>. I am going to distill it and add a few notes about how to make your use of Git as unnoticeable to the other SVN users as possible.</p>

<h4 id='step_one_clone_your_externals'>Step One: Clone your externals</h4>

<p>Git submodules are fantastic, but to use them you need Git repositories for each of your externals. Fortunately, you can easily clone them with <code>git-svn</code>. First, to list your externals:</p>
<div class='highlight'><pre><code class='text'>$ svn propget svn:externals http://example.com/svn/app/vendor/plugins foo_plugin http://example.com/svn/foo_plugin/trunk
</code></pre>
</div>
<p>Now you should make a directory to put your clones of these in.</p>
<div class='highlight'><pre><code class='text'>$ mkdir ~/Projects/plugins
</code></pre>
</div>
<p>And then cloning them is as simple as this:</p>
<div class='highlight'><pre><code class='text'>$ git svn clone http://example.com/svn/app/foo_plugin/trunk ~/Projects/plugins/foo_plugin
</code></pre>
</div>
<h4 id='step_two_clone_your_svn_repository'>Step Two: Clone your SVN repository</h4>

<p>The next step is to clone your repository sans-externals. We&#8217;ll use <code>git-svn</code> to do that, but we&#8217;ll use it in a slightly different manner. The Git folks recognize that there is a standard layout for SVN repositories. If you tell it where the trunk, branches and tags are kept relative the the URI you provide, it will try to preserve that information. It makes branches for each of the SVN branches, and it makes branches for the tags as well.</p>

<p>Just do this wherever you want your project to live. You may want to rename any SVN working copies you have so that there aren&#8217;t any naming conflicts.</p>
<div class='highlight'><pre><code class='text'>$ git svn clone http://example.com/svn/app -T trunk -t tags -b branches
</code></pre>
</div>
<p>That&#8217;ll give you a git repository named &#8220;app&#8221; in the current directory. The master branch will be a remote tracking branch that is set up to track trunk, and other branches are set up for any tags and branches.</p>

<h4 id='step_three_hook_up_the_submodules'>Step Three: Hook up the submodules</h4>

<p>Now that we&#8217;ve got Git repositories for all of the plugins, and a Git repository for our project, we can hook everything up. We will set up a submodule for the external we cloned above.</p>

<p>From within the top-level of your project repository do this:</p>
<div class='highlight'><pre><code class='text'>$ git submodule add ~/Projects/plugins/foo_plugin vendor/plugins/foo_plugin
</code></pre>
</div>
<p>After you&#8217;ve added the submodule do this:</p>
<div class='highlight'><pre><code class='text'>$ git submodule init
$ git submodule update
</code></pre>
</div>
<p>That should get the code from the plugin repository and into your project repository just like the external did.</p>

<h4 id='step_four_cover_your_tracks'>Step Four: Cover your tracks</h4>

<p>When you are using <code>git-svn</code> it commits all of your Git commits into SVN, and you don&#8217;t really want to commit anything into your Git that you don&#8217;t want finding it&#8217;s way into SVN (at least not on the branch that you commit to SVN from). But it is easy to set Git up to ignore all of the files.</p>

<p>First, let&#8217;s make sure Git ignores all the same things SVN was ignoring:</p>
<div class='highlight'><pre><code class='text'>$ git svn show-ignore &gt;&gt; .git/info/exclude
</code></pre>
</div>
<p>Then open up <code>.git/info/exclude</code> and add these lines to it:</p>
<div class='highlight'><pre><code class='text'># .git/info/exclude
.gitignore
.gitmodules
./vendor/plugins/foo_plugin
</code></pre>
</div>
<p>That should prevent you from committing anything into SVN that is git- specific.</p>

<h4 id='step_five_using_this_thing'>Step Five: Using this thing</h4>

<p>So once you&#8217;re all set up, you&#8217;ll want to be able to interact with the SVN repository. Here are your two basic operations.</p>

<p>Update from SVN</p>
<div class='highlight'><pre><code class='text'>$ git svn rebase
</code></pre>
</div>
<p>This works just like <code>git-rebase</code>, except it pulls from SVN instead of some other Git branch. It will not work if there are changes that have not been committed to Git. What it does is roll back all of the changes since the last time, and then update from SVN, then reapply the changes in order. If there are conflicts, you resolve them as you would if you were using <code>git-rebase</code>.</p>

<p>Commit to SVN</p>
<div class='highlight'><pre><code class='text'>$ git svn dcommit
</code></pre>
</div>
<p>This will take all of the commits since your last time and commit them one at a time to SVN. This allows all those people still using SVN to see each individual commit instead of one monster commit.</p>

<p>I recommend using SVN to do anything more involved than simple adds, removes, renames and edits.</p>

<p>Something to be aware of with this set up is that your submodules are effectively frozen at whichever revision you cloned. If you want to update them, you&#8217;ll need to first update the cloned repository, and then run this command at the root of your repository:</p>
<div class='highlight'><pre><code class='text'>$ git submodule update
</code></pre>
</div>
<p>Another caveat is that you need to keep your development as linear as you can. Don&#8217;t try to do anything crazy with lots of branches and merges between them. SVN can&#8217;t really make sense of it. The big deal here is you want to use <code>git-
rebase</code> to pull in changes from SVN.</p>

<p>Here&#8217;s my workflow. I use a branch named work to do all of my work in. I will sync it up with SVN several times a day, just so it isn&#8217;t too stale. This is how I do that:</p>
<div class='highlight'><pre><code class='text'>$ git checkout master
$ git svn rebase
$ git checkout work
$ git rebase master
</code></pre>
</div>
<p>Then, when I&#8217;ve commited all of my changes to my work branch, and I&#8217;m ready to commit to SVN:</p>
<div class='highlight'><pre><code class='text'>$ git checkout master
$ git merge work
$ git svn rebase # Just to be safe
$ git svn dcommit
</code></pre>
</div>
<p>It works well, and it allows me to do my work disconnected from the network.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/03/03/broken-window-in-activerecord-activerecordstatementinvalid.html" rel="bookmark" title="Permanent Link to Broken Window in ActiveRecord: <code>ActiveRecord::StatementInvalid</code>">Broken Window in ActiveRecord: <code>ActiveRecord::StatementInvalid</code></a></h3>
  <p class="date">March 3rd, 2008</p>
  <div class="entry"><p>I love ruby, and I love Rails, but in some ways it really is a ghetto. It has a lot of <a href='http://en.wikipedia.org/wiki/Fixing_Broken_Windows'>broken windows</a> that only serve to encourage bad coding from developers who should know better. Today I ran into an example of one of those broken windows and I was beside myself. I could not believe what I was reading.</p>

<p>One of the projects I work on for my employer is an import process that takes a long time. In order to make it resilient to database fail-overs, I wanted to catch the exception that is raised when the connection dies, wait a few seconds, and then try to reconnect. The idea is simple, and it works once I account for the broken window, but I am not pleased with the code I had to write.</p>

<p>When the database connection disappears, the database driver throws an exception. <code>ActiveRecord::Base</code> catches that exception and does this:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># Find this in Rails 2.0.2</span>
<span class='c1'># active_record/connection_adapter/abstract_adapter.rb:121</span>

<span class='k'>rescue</span> <span class='no'>Exception</span> <span class='o'>=&gt;</span> <span class='n'>e</span>
  <span class='c1'># Log message and raise exception.</span>
  <span class='c1'># Set last_verfication to 0, so that connection gets verified</span>
  <span class='c1'># upon reentering the request loop</span>
  <span class='vi'>@last_verification</span> <span class='o'>=</span> <span class='mi'>0</span>
  <span class='n'>message</span> <span class='o'>=</span> <span class='s2'>&quot;</span><span class='si'>#{</span><span class='n'>e</span><span class='o'>.</span><span class='n'>class</span><span class='o'>.</span><span class='n'>name</span><span class='si'>}</span><span class='s2'>: </span><span class='si'>#{</span><span class='n'>e</span><span class='o'>.</span><span class='n'>message</span><span class='si'>}</span><span class='s2'>: </span><span class='si'>#{</span><span class='n'>sql</span><span class='si'>}</span><span class='s2'>&quot;</span>
  <span class='n'>log_info</span><span class='p'>(</span><span class='n'>message</span><span class='p'>,</span> <span class='nb'>name</span><span class='p'>,</span> <span class='mi'>0</span><span class='p'>)</span>
  <span class='k'>raise</span> <span class='no'>ActiveRecord</span><span class='o'>::</span><span class='no'>StatementInvalid</span><span class='p'>,</span> <span class='n'>message</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>This is the exception handler that catches all exceptions raised during a query run by ActiveRecord. As you can see, it snags the class name, and the exception message off of the exception, and then throws the object away, reraising with <code>ActiveRecord::StatementInvalid</code>. So, if your database driver has hundreds of error codes which are provided in order for you to tell specifically what error occurred, such as <code>Mysql::Error</code>, you lost them.</p>

<p>So ActiveRecord provides <em>one</em> exception that covers everything from primary key violations to database connection errors, and the only way to distinguish them is by inspecting the message. Surely, that can&#8217;t be true, right? I dig further and find this:</p>
<div class='highlight'><pre><code class='text'># Find this in Rails 2.0.2
# active_record/connection_adapters/mysql_adapter.rb:244
#
# Note: I snipped the error message because it is very long

rescue ActiveRecord::StatementInvalid =&gt; exception
  if exception.message.split(&quot;:&quot;).first =~ /Packets out of order/
    raise ActiveRecord::StatementInvalid, snipped_error_message
  else
    raise
  end
end
</code></pre>
</div>
<p>That is just completely unacceptable. I can find it in my heart to forgive the abstract adapter for doing something that throws away implementation-specific information, but the Mysql adapter should remedy that. It willingly lets it&#8217;s exception information be cast aside and goes about inspecting what the abstract adapter had the decency to keep around.</p>

<p>&#8220;But that information is good enough to tell what the exception is,&#8221; you might say.</p>

<p>Until the Mysql folks change the error message. The Mysql API exposes numeric constants, and I&#8217;m sure they&#8217;re very careful to keep them the same, but do you think they take the same approach to error messages? I doubt it. They provide a function that will give you an error message given the numeric constant, and encourage you to use it. That&#8217;s what the Mysql bindings for ruby do.</p>

<p>Expecting developers to inspect the exception message is essentially promoting programming with magic numbers. Sure, they&#8217;re string literals, but they&#8217;re still duplicated information, and extremely brittle.</p>

<p>All I&#8217;d want is an <code>inner_exception</code> attribute available on <code>ActiveRecord::StatementInvalid</code> or maybe its parent, and then assign it when doing reraises. Is that too much to ask for?</p></div>
</div>

<div class="post">
  <h3><a href="/2008/02/22/svn-git-1-still-awesome.html" rel="bookmark" title="Permanent Link to SVN + Git + 1 = Still Awesome">SVN + Git + 1 = Still Awesome</a></h3>
  <p class="date">February 22nd, 2008</p>
  <div class="entry"><p>Yesterday I wrote about using <a href='http://blog.alieniloquent.com/2008/02/20/svn-git-awesome/'>SVN and Git</a> together to have version control away from the network your SVN server is on. Now, I&#8217;ll admit, I wrote that shortly after figuring it out and doing it. So, at that time, I hadn&#8217;t actually come back into the office and merged my changes with the repository and committed them. Having done that a couple of times now, I&#8217;m here to say that this setup is fantastic.</p>

<p>So using this system you&#8217;re either at the office, so you can use SVN, or you&#8217;re not, so you have to use Git. I&#8217;ll give steps to follow for each. You should probably read the documentation available from the <a href='http://git.or.cz/'>Git</a> website to familiarize yourself further with these commands.</p>

<p>These steps assume that you&#8217;ve made a Git branch using the following command:</p>
<div class='highlight'><pre><code class='text'>$ git branch home
</code></pre>
</div>
<h4 id='taking_your_work_home_svn__git'>Taking your work home: SVN -&gt; Git</h4>

<p>Make sure your SVN working copy is as up to date as you want it. Ideally, commit any changes. But, if you&#8217;re in the middle of a change set, that&#8217;s fine.</p>
<div class='highlight'><pre><code class='text'>$ git commit -a -m &quot;Merging in changes from SVN since last commit&quot;
$ git checkout home
$ git merge master
</code></pre>
</div>
<p>Now you&#8217;re ready to use Git to continue making your changes while you&#8217;re away from the office.</p>

<h4 id='getting_back_to_work_git__svn'>Getting back to work: Git -&gt; SVN</h4>

<p>Make sure your Git changes are all committed to the <code>home</code> branch.</p>
<div class='highlight'><pre><code class='text'>$ git checkout master
$ svn up
</code></pre>
</div>
<p>Resolve any conflicts from SVN.</p>
<div class='highlight'><pre><code class='text'>$ git merge home
</code></pre>
</div>
<p>Resolve any conflicts from Git.</p>

<p>Now you can continue with your changes using SVN, or commit them right away if they&#8217;re already perfect.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/02/20/svn-git-awesome.html" rel="bookmark" title="Permanent Link to SVN + Git = Awesome">SVN + Git = Awesome</a></h3>
  <p class="date">February 20th, 2008</p>
  <div class="entry"><p>I&#8217;ve been a big fan of <a href='http://subversion.tigris.org'>SVN</a> for several years now. I even helped my former employer <a href='http://blog.alieniloquent.com/2005/10/26/now-powered-by-subversion/'>migrate</a> from VSS a couple of years ago after I sold everybody on the idea. I have lots of love for SVN, but it has its limitations, especially the need to have network connectivity to a central repository. I know at least <a href='http://blog.excastle.com'>some</a> <a href='http://blog.briankohrs.com'>people</a> would love to have a way to still commit code when offline. So, here&#8217;s how I did it with SVN and <a href='http://git.or.cz/'>Git</a>.</p>

<p>Git is a DVCS that works differently than SVN. Instead of making changes in your working copy and submitting them to a central repository, your working copy <em>is</em> your repository. You can push changes to another repository or you can pull changes from another repository. It&#8217;s a nice way of working, and it&#8217;s what they use on the Linux kernel. The Git folks have a nice <a href='http://git.or.cz/course/svn.html'>tutorial</a> for SVN users.</p>

<p>The key feature of Git that makes it well suited for use alongside SVN is that it keeps <em>all</em> of its metadata in one folder at the top of your repository. It does not put one in each directory like SVN does. So you can make your SVN working copy into a Git repository and then ignore the folder and SVN knows nothing about it. Here&#8217;s what you do.</p>

<p>At the top level of your SVN working copy:</p>
<div class='highlight'><pre><code class='text'>$ git init
$ echo .svn &gt; .gitignore
$ git add *
$ git add .gitignore
$ git commit -m &quot;Initial commit&quot;
</code></pre>
</div>
<p>Now we just need to teach SVN to ignore the Git stuff. So open up your <code>~/.subversion/config</code> file and find the <code>[miscellany]</code> section. You should see a commented out setting for <code>global-ignores</code>. Uncomment it and add <code>.git*</code> to it like this:</p>
<div class='highlight'><pre><code class='text'>[miscellany]
### Set global-ignores to a set of whitespace-delimited globs
### which Subversion will ignore in its &#39;status&#39; output, and
### while importing or adding files and directories.

global-ignores = *.o *.lo *.la \#*\# .*.rej *.rej .*~ *~ .\#* .DS_Store .git*
</code></pre>
</div>
<p>And voila! When you&#8217;re able to connect to your SVN repo, you can use SVN. But when you&#8217;re offline and still want the ability to use version control to incrementally save your changes, you can use Git. They&#8217;re working on the same files, so they play together very nicely.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/02/18/crunch-mode.html" rel="bookmark" title="Permanent Link to Crunch Mode">Crunch Mode</a></h3>
  <p class="date">February 18th, 2008</p>
  <div class="entry"><p>James Golick writes about <a href='http://jamesgolick.com/2008/2/18/the-crunch-mode-paradox-turning-superstars-average'>crunch mode</a> and how it can turn a team of even the best all-star code artists in to mediocre programmers.</p>

<p>I have been on an agile team full of all-star programmers. Every one of them as bright as the sun, and every one of them dedicated to writing quality software. Sure, we inherited a legacy code base of nearly a million lines of not-so-all-star code, but that&#8217;s the same situation everybody else is in too, right? It took us a couple of years to really get the agile juices flowing, but once we did, it was great. Except for crunch mode.</p>

<p>I&#8217;ve seen what James is talking about first hand. I&#8217;ve <em>been</em> what James is talking about. What I&#8217;ve never understood is why crunch mode seems more appealing to managers than facilitating the things a team needs to truly deliver on the promise of constantly shippable code. To me, the value proposition of being able to ship after any week- or month-long iteration is a big win over going into crunch mode to hit a date.</p>

<p>But I&#8217;m a developer, what do I know about managing projects, right?</p></div>
</div>

<div class="post">
  <h3><a href="/2008/02/18/beauty-is-important.html" rel="bookmark" title="Permanent Link to Beauty is Important">Beauty is Important</a></h3>
  <p class="date">February 18th, 2008</p>
  <div class="entry"><p>I was reminded of one of my favorite quotes today.</p>

<blockquote>
<p>Beauty is more important in computing than anywhere else in technology because software is so complicated. Beauty is the ultimate defense against complexity.</p>

<p>&#8211; <a href='http://www.amazon.com/exec/obidos/ASIN/046504316X'>Machine Beauty: Elegance and the Heart of Computing</a>, David Gelernter</p>
</blockquote></div>
</div>

<div class="post">
  <h3><a href="/2008/02/15/string-transforms-using-enumerableinject.html" rel="bookmark" title="Permanent Link to String transforms using <code>Enumerable#inject</code>">String transforms using <code>Enumerable#inject</code></a></h3>
  <p class="date">February 15th, 2008</p>
  <div class="entry"><p>I love functional programming, and I love <a href='http://www.ruby-lang.org'>Ruby</a>. One of the most awesome things about Ruby is how much it borrows from the functional programming mindset. One of the most powerful concepts that functional programming brings to the table is higher-order functions. Ruby&#8217;s <code>Enumerable</code> module is a great example of how it embraces the idea of higher-order functions to abstract out the various things you do with a collection and let you focus on the operation for each item.</p>

<p>One of the most mysterious methods on <code>Enumerable</code> is <code>Enumerable#inject</code>. The example that&#8217;s always given is this:</p>
<div class='highlight'><pre><code class='text'>irb&gt; [1, 2, 3, 4].inject(0) {|sum, i| sum + i}
10
</code></pre>
</div>
<p>That&#8217;s fine, and usually makes sense. But when you try to branch out into more esoteric uses of inject, it can get confusing. So I&#8217;m going to give an example of accomplishing something useful with inject that you hopefully find useful.</p>

<p>I always find myself doing a sequence of substitutions on a string. For example, when I implement a <a href='http://tools.ietf.org/html/rfc854'>Telnet</a> client, I like to normalize the line endings I&#8217;m sending so that they&#8217;re sane. I accomplish that by translating &#8220;\r\n&#8221; to &#8220;\n&#8221;, then translating &#8220;\r&#8221; to &#8220;\n&#8221;, then translating &#8220;\n&#8221; to &#8220;\r\n&#8221;. It&#8217;s a simple thing to do, and I could do it like this:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>string</span><span class='o'>.</span><span class='n'>gsub</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\r\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>)</span><span class='o'>.</span><span class='n'>gsub</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\r</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>)</span><span class='o'>.</span><span class='n'>gsub</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='s2'>&quot;</span><span class='se'>\r\n</span><span class='s2'>&quot;</span><span class='p'>)</span>
</code></pre>
</div>
<p>But that&#8217;s not very extensible. I&#8217;d like to apply this idea of a sequence of substitutions in an abstract way so that I can do dynamically. And while I could do something with <code>Object#send</code>, that&#8217;s like cheating. This is where inject comes to the rescue.</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>def</span> <span class='nf'>normalize_line_endings</span><span class='p'>(</span><span class='n'>string</span><span class='p'>)</span>
  <span class='n'>transforms</span> <span class='o'>=</span> <span class='o'>[</span><span class='nb'>proc</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>s</span><span class='o'>|</span> <span class='n'>s</span><span class='o'>.</span><span class='n'>gsub</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\r\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>)},</span>
                <span class='nb'>proc</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>s</span><span class='o'>|</span> <span class='n'>s</span><span class='o'>.</span><span class='n'>gsub</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\r</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>)},</span>
                <span class='nb'>proc</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>s</span><span class='o'>|</span> <span class='n'>s</span><span class='o'>.</span><span class='n'>gsub</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='s2'>&quot;</span><span class='se'>\r\n</span><span class='s2'>&quot;</span><span class='p'>)}</span><span class='o'>]</span>
  <span class='n'>transforms</span><span class='o'>.</span><span class='n'>inject</span><span class='p'>(</span><span class='n'>string</span><span class='p'>)</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>s</span><span class='p'>,</span> <span class='n'>transform</span><span class='o'>|</span> <span class='n'>transform</span><span class='o'>.</span><span class='n'>call</span><span class='p'>(</span><span class='n'>s</span><span class='p'>)}</span>
<span class='k'>end</span>
</code></pre>
</div>
<p><code>Kernel#proc</code> (or <code>Kernel#lambda</code> if you prefer) is Ruby&#8217;s way of making higher-order functions. It returns a block which you can then call with an argument. In the above code, I make an array of transforms that take a string and return a string. The call to inject at the end is where the magic happens. It calls the first transform with <code>string</code> which was provided as the argument to inject. Then it calls the second transform with the result of the first, and it calls the third transform with the result of the second. That list could be as big as you want. It could even be dynamically generated.</p>

<p>That&#8217;s nice, but it&#8217;s still a a little verbose. I like to hide my use of <code>Kernel#proc</code> behind a declarative interface when I&#8217;m doing this sort of thing with it. So here&#8217;s how we can rewrite the method.</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>def</span> <span class='nf'>transform</span><span class='p'>(</span><span class='n'>string</span><span class='p'>,</span> <span class='n'>specifications</span> <span class='o'>=</span> <span class='o'>[]</span><span class='p'>)</span>
  <span class='n'>transforms</span> <span class='o'>=</span> <span class='n'>specifications</span><span class='o'>.</span><span class='n'>collect</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>spec</span><span class='o'>|</span>
                 <span class='nb'>proc</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>s</span><span class='o'>|</span> <span class='n'>s</span><span class='o'>.</span><span class='n'>gsub</span><span class='p'>(</span><span class='n'>spec</span><span class='o'>[</span><span class='ss'>:from</span><span class='o'>]</span><span class='p'>,</span> <span class='n'>spec</span><span class='o'>[</span><span class='ss'>:to</span><span class='o'>]</span><span class='p'>)}</span>
               <span class='k'>end</span>
  <span class='n'>transforms</span><span class='o'>.</span><span class='n'>inject</span><span class='p'>(</span><span class='n'>string</span><span class='p'>)</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>s</span><span class='p'>,</span> <span class='n'>transform</span><span class='o'>|</span> <span class='n'>transform</span><span class='o'>.</span><span class='n'>call</span><span class='p'>(</span><span class='n'>s</span><span class='p'>)}</span>
<span class='k'>end</span>

<span class='k'>def</span> <span class='nf'>normalize_line_endings</span><span class='p'>(</span><span class='n'>string</span><span class='p'>)</span>
  <span class='n'>transform</span><span class='p'>(</span><span class='n'>string</span><span class='p'>,</span> <span class='o'>[</span><span class='p'>{</span><span class='ss'>:from</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\r\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='ss'>:to</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>},</span>
                     <span class='p'>{</span><span class='ss'>:from</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\r</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='ss'>:to</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>},</span>
                     <span class='p'>{</span><span class='ss'>:from</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='ss'>:to</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\r\n</span><span class='s2'>&quot;</span><span class='p'>}</span><span class='o'>]</span><span class='p'>)</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>Of course, at that point, we don&#8217;t really need to create the procs. We can just use inject right on the specifications array, so the final code I came up with for this was:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>def</span> <span class='nf'>transform</span><span class='p'>(</span><span class='n'>string</span><span class='p'>,</span> <span class='n'>specifications</span> <span class='o'>=</span> <span class='o'>[]</span><span class='p'>)</span>
  <span class='n'>specifications</span><span class='o'>.</span><span class='n'>inject</span><span class='p'>(</span><span class='n'>string</span><span class='p'>)</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>s</span><span class='p'>,</span> <span class='n'>spec</span><span class='o'>|</span>
    <span class='n'>s</span><span class='o'>.</span><span class='n'>gsub</span><span class='p'>(</span><span class='n'>spec</span><span class='o'>[</span><span class='ss'>:from</span><span class='o'>]</span><span class='p'>,</span> <span class='n'>spec</span><span class='o'>[</span><span class='ss'>:to</span><span class='o'>]</span><span class='p'>)</span>
  <span class='k'>end</span>
<span class='k'>end</span>

<span class='k'>def</span> <span class='nf'>normalize_line_endings</span><span class='p'>(</span><span class='n'>string</span><span class='p'>)</span>
  <span class='n'>transform</span><span class='p'>(</span><span class='n'>string</span><span class='p'>,</span> <span class='o'>[</span><span class='p'>{</span><span class='ss'>:from</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\r\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='ss'>:to</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>},</span>
                     <span class='p'>{</span><span class='ss'>:from</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\r</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='ss'>:to</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>},</span>
                     <span class='p'>{</span><span class='ss'>:from</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='ss'>:to</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;</span><span class='se'>\r\n</span><span class='s2'>&quot;</span><span class='p'>}</span><span class='o'>]</span><span class='p'>)</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>Now that can be used with any list of transformations. Those transformations can be dynamically generated, and it&#8217;s a very clean implementation. That is the power of <code>Enumerable#inject</code>.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/02/06/ocaml-talk.html" rel="bookmark" title="Permanent Link to OCaml Talk">OCaml Talk</a></h3>
  <p class="date">February 6th, 2008</p>
  <div class="entry"><p>So, I was going to give a talk on <a href='http://caml.inria.fr/'>OCaml</a> at <a href='http://odynug.blainebuxton.com/'>ODYNUG</a> last night. But, well, snow happened, and the meeting was canceled.</p>

<p>I will be giving the talk next month, on March 4th along with <a href='http://bablingmonkey.blogspot.com/'>Brent Adkisson</a> who will be giving a talk about <a href='http://code.google.com/android/'>Android</a>.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/01/31/adding-files-to-auto-mode-alist.html" rel="bookmark" title="Permanent Link to Adding files to <code>auto-mode-alist</code>">Adding files to <code>auto-mode-alist</code></a></h3>
  <p class="date">January 31st, 2008</p>
  <div class="entry"><p>One of the things that I require from an editor is decent syntax highlighting. Emacs provides me that, and it also provides me with awesome indentation (I&#8217;ve grown addicted to hitting TAB and having my text just go to the right place regardless of where my cursor is). Emacs has a mode for every occasion and typically will load the right one based on the name of the file or its content. Recently, mine stopped doing that.</p>

<p>At first it was annoying. I&#8217;d open a LaTeX file and it wouldn&#8217;t change to <code>latex-mode</code>, or I&#8217;d open a C file and it wouldn&#8217;t go into <code>c-mode</code>, and worst of all, I&#8217;d load Emacs lisp files and they wouldn&#8217;t load in <code>emacs-lisp-mode</code>. I would just switch the mode by hand, but my patience could only last for so long.</p>

<p>Yesterday I finally took the time to find the trouble, shoot it, and replace it with better code. In my <code>.emacs</code> I had this:</p>
<div class='highlight'><pre><code class='text'>(setq auto-mode-alist
      (append
       &#39;((&quot;\\.dtd$&quot; . xml-mode)
         (&quot;\\.xml$&quot; . xml-mode)
         (&quot;\\.yml$&quot; . conf-mode)
         (&quot;bash_profile$&quot; . sh-mode)
         (&quot;bashrc$&quot; . sh-mode))
       auto-mode-alist))
</code></pre>
</div>
<p>I&#8217;ve seen that same code all over the internet, and it used to work just fine. But for some reason, now it does something to my <code>auto-mode-alist</code> and makes Emacs hate it for some reason. So I do some research. The recommended way to put stuff in an alist like that is <code>ADD-TO-LIST</code>.</p>

<p>So the above code becomes this:</p>
<div class='highlight'><pre><code class='text'>(mapcar (lambda (mapping) (add-to-list &#39;auto-mode-alist mapping))
        &#39;((&quot;\\.dtd$&quot; . xml-mode)
          (&quot;\\.xml$&quot; . xml-mode)
          (&quot;\\.yml$&quot; . conf-mode)
          (&quot;bash_profile$&quot; . sh-mode)
          (&quot;bashrc$&quot; . sh-mode)))
</code></pre>
</div>
<p>Putting that code in fixed my problems, and now all of my modes load correctly.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/01/29/living-in-the-house-that-rails-built.html" rel="bookmark" title="Permanent Link to Living In the House That Rails Built">Living In the House That Rails Built</a></h3>
  <p class="date">January 29th, 2008</p>
  <div class="entry"><p>I wanted to share a snippet of code. This code will print a call stack to <code>STDOUT</code> every time a Ruby class definition is evaluated. It is particularly useful when you find that class constants are being mysteriously redefined.</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Foo</span>
  <span class='nb'>puts</span> <span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'>Required from:</span><span class='se'>\n</span><span class='s2'> </span><span class='si'>#{</span><span class='no'>Kernel</span><span class='o'>.</span><span class='n'>caller</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\n</span><span class='s2'> &quot;</span><span class='p'>)</span><span class='si'>}</span><span class='s2'>&quot;</span>
  <span class='c1'># ...</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>What inspired me to write that code? Rails did. The key to writing Ruby on Rails is that you&#8217;re writing Ruby <em>on Rails</em>. You don&#8217;t follow the Rails best practices because they&#8217;re convenient. You follow the Rails best practices because your program won&#8217;t work unless you do. Just like trains, you stay on the track and everything is great. If you try to take your train off-track, then it&#8217;s gruesome enough to make the nightly news.</p>

<p>How did I derail my application such that I cared how and where a file was being required? I wrote a unit test that explicitly required a model object. Oops. Remember that the semantics of <code>require</code> is load-once based on the name. So:</p>
<div class='highlight'><pre><code class='ruby'><span class='nb'>require</span> <span class='s2'>&quot;foo&quot;</span>
</code></pre>
</div>
<p>and:</p>
<div class='highlight'><pre><code class='ruby'><span class='nb'>require</span> <span class='s2'>&quot;models/foo&quot;</span>
</code></pre>
</div>
<p>are very different to require. Rails is super helpful and requires everything that it makes for you. So it requires models for you, even when you run your unit tests.</p>

<p>So take this code:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Foo</span> <span class='o'>&lt;</span> <span class='no'>ActiveRecord</span><span class='o'>::</span><span class='no'>Base</span>
  <span class='no'>RAILS_IS_A_GHETTO</span> <span class='o'>=</span> <span class='kp'>true</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>And then write a test for something that Rails didn&#8217;t generate (such as something in the <code>lib</code> directory like I did):</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># Require some other stuff</span>
<span class='nb'>require</span> <span class='s2'>&quot;foo&quot;</span>

<span class='k'>class</span> <span class='nc'>TestTruth</span> <span class='o'>&lt;</span> <span class='no'>Test</span><span class='o'>::</span><span class='no'>Unit</span><span class='o'>::</span><span class='no'>TestCase</span>
  <span class='k'>def</span> <span class='nf'>test_truth</span>
    <span class='n'>assert</span> <span class='kp'>true</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>If you <code>rake test</code> you will get an error complaining that <code>RAILS_IS_A_GHETTO</code> was reinitialized, and that&#8217;s because Rails loads it for you as &#8220;models/foo&#8221; and you load it as &#8220;foo&#8221; so it gets loaded twice.</p>

<p>The moral of the story is: let Rails load the things it built, and you load the things you built.</p></div>
</div>

<div class="post">
  <h3><a href="/2008/01/03/making-terminal-bearable.html" rel="bookmark" title="Permanent Link to Making Terminal Bearable">Making Terminal Bearable</a></h3>
  <p class="date">January 3rd, 2008</p>
  <div class="entry"><p>I&#8217;ve been using Macintosh computers for several years now, but I came to them from the Unix world. There were several expectations I had from my terminal emulator. Among them were that the key that says Alt on it should be my Meta key for Emacs key-chords, and that the Page Up and Page Down keys should page up and page down in my application. None of those behaviors are the default, so fixing them is one of the first things I do when I get a Mac.</p>

<p>In Leopard these settings are all in the Settings section of Preferences (Cmd-, or Terminal &gt; Preferences&#8230;), but in previous versions they are in the Window Settings screen (Terminal &gt; Window Settings&#8230;).</p>

<p>First, to take care of the Alt key issue, go to the Keyboard section of the settings. There is a checkbox toward the bottom that says &#8220;Use option key as meta.&#8221; Check it.</p>

<p>With that problem solved, all that is left are the paging keys. The default behavior is to have Shift Page Up send Page Up to the terminal and Page Up and do the same for Page Down. In the Keyboard Settings you should see a grid with keystrokes on the left and text on the right. In many cases it will be an ANSI escape sequence to send to the terminal, in some cases it will be a special action. Here&#8217;s what you want to set things to.</p>

<ul>
<li>
<p><code>page down = send string to shell: \033[6~</code></p>
</li>

<li>
<p><code>page up = send string to shell: \033[5~</code></p>
</li>

<li>
<p><code>shift page down = scroll to next page in buffer</code></p>
</li>

<li>
<p><code>shift page up = scroll to previous page in buffer</code></p>
</li>
</ul>

<p>That effectively just swaps the keys, so that you still have the ability to scroll your Terminal buffer with the keyboard.</p>

<p>After I fix the keyboard, I like to fiddle with colors and other things, which will all be in the same preferences dialogs. Then, after all the tweaks and fixes, Terminal is ready to use.</p></div>
</div>


       </div>
     </div>
     <div class="yui-b">
       <div class="yui-u sidebar">
         <h2 class="sectionheader first">Archives</h2>
         <ul>
           
           <li><a href="/2011/">2011</a></li>
           
           <li><a href="/2010/">2010</a></li>
           
           <li><a href="/2009/">2009</a></li>
           
           <li><a href="/2008/">2008</a></li>
           
           <li><a href="/2007/">2007</a></li>
           
           <li><a href="/2006/">2006</a></li>
           
           <li><a href="/2005/">2005</a></li>
           
         </ul>
       </div>
     </div>
   </div>
   <div id="ft">
     <p>Layout, design, graphics, photography and text all &copy; 2005-2010 Samuel Tesla unless otherwise noted.</p>
     <p>Portions of the site layout use Yahoo! YUI Reset, Fonts &amp; Grids.</p>
   </div>
 </div>

<!-- BEGIN GOOGLE ANALYTICS -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-12538528-2");
pageTracker._setDomainName(".alieniloquent.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- END GOOGLE ANALYTICS -->

</body>
</html>
